<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/font-roboto/roboto.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">

<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">

<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/paper-spinner/paper-spinner.html">
  
<!-- Custom Components of the app -->
<link rel="import" href="headerMatch.html">
<link rel="import" href="drawer-matchmaker.html">
<link rel="import" href="../paginas/search-results.html">
<link rel="import" href="../paginas/list-element-matchmaker.html">

<dom-module id="app-main">

  <template>
    <style>
      body {
        margin: 0;
        font-family: 'Roboto', 'Noto', sans-serif;
        background-color: #eee;
      }
      
      app-header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background-color: #0277bd;
      color: #fff;
    }
    app-header paper-icon-button {
      --paper-icon-button-ink-color: white;
    }
    app-drawer {
      top: -60px !important;
    }
    
     app-drawer-layout:not([narrow]) [drawer-toggle] {
          display: none;
        }
        
    .main-content {
        padding: 10px;
      }
  
    </style>
    
    <!-- app-location binds to the app's URL -->
    <app-location route="{{route}}"></app-location>

    <!-- this app-route manages the top-level routes -->
    <app-route
      route="{{route}}"
      pattern="/:view"
      data="{{routeData}}"
      tail="{{subroute}}"></app-route>
    
   <!-- Request to get the currentUser -->
   <iron-ajax
      auto 
      id="menuRequest"
      url="../../data/test-currentUser.json" 
      handle-as="json"
      on-response="handleCurrentUserResponse"></iron-ajax>
    
    <!-- Request to get the menuOptions of the user -->
    <iron-ajax
      auto 
      id="menuRequest"
      url="../../data/test-menuOptions.json" 
      handle-as="json"
      on-response="handleMenuResponse"></iron-ajax>

  <app-header-layout>
   <!-- 
    <app-header class="mainHeader" condenses fixed effects="resize-title blend-background waterfall" slot="header">
    -->
    <app-header fixed effects="resize-title blend-background waterfall" slot="header">
      <header-matchmaker activeuser="[[user]]"> </header-matchmaker>
    </app-header>
    
    <app-drawer-layout id="drawerLayout">
      <app-drawer id="startDrawer" slot="drawer">
        <drawer-matchmaker activeuser="[[user]]" menuoptions="[[menuOptions]]"></drawer-matchmaker>
      </app-drawer>
      
      <div class="main-content">
    
      <!-- Aquí tendrían que estar listadas TODAS las putas páginas, y eso estaría medio puteado mano -->
      <iron-pages id="pages" selected-attribute="activated" selected="{{pageSelected}}" attr-for-selected="name" fallback-selection="view404" role="main">
        <list-element-matchmaker name="lista1" focus="{{onFocus}}"> </list-element-matchmaker>
        <list-element-matchmaker name="lista2" focus="{{onFocus}}"> </list-element-matchmaker>
        <list-element-matchmaker name="lista3" focus="{{onFocus}}"> </list-element-matchmaker>
        <dashboard-page name="dashboard"></dashboard-page>
        <search-results name="search"></search-results>
        <div name="seVan"><p> Page 4 bish </p></div>
        <my-view404 name="view404"><p>Page 404 to be defined</p></my-view404>
      </iron-pages>
      <!--  <paper-spinner active="[[loading]]"></paper-spinner> -->

    </div>
 
    </app-drawer-layout>
    
  </app-header-layout>
  </template>
  
   <script>

  Polymer({

    is: 'app-main',

    properties: {
    	pageSelected: {
    		type: String
    	},
    	loading: {
    		type: Boolean
    	}
    },
    
    observers: [
    	  '_routeChanged(route.*)',
    	  '_viewChanged(routeData.view)'
    ],
    
    _routeChanged: function(changeRecord) {
    	if (changeRecord.path === 'path') {
    	  console.log('Path changed!');
    	}
    },
    
    _viewChanged: function(view) {
      var pages = document.getElementById('pages');
      pages.select(view);
     },

    _drawerSelected: function() {
      if (!this.$.drawer.persistent) this.$.drawer.close();
    },

    handleCurrentUserResponse: function (data) {
    	this.user = data.detail.response;
    },
    
    handleMenuResponse: function (data) {
    	this.menuOptions = data.detail.response;
    },
    
    onFocus: function(event) {
      console.log("Esta madre cambio bish!, es");
    },
    
    ready: function() {
    	this.pageSelected = 'lista1';
    	this.loading = true;
    	var drawerLayout = document.getElementById('drawerLayout');
    	  var toggle = document.getElementById('toggle');
    	  toggle.addEventListener('click', function() {
    	    if (drawerLayout.forceNarrow || !drawerLayout.narrow) {
    	      drawerLayout.forceNarrow = !drawerLayout.forceNarrow;
    	    } else {
    	      drawerLayout.drawer.toggle();
    	    }
    	  });
    },
  });
  


  
  </script>

</dom-module>